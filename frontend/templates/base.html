<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fer Futuro Forbes (3F) | {% block title %}{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="/static/img/favicon.svg">

    <!-- Google Font: Inter & Orbitron -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Orbitron:wght@400;700&display=swap">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- AdminLTE 4 CSS (CDN for now) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0-beta2/dist/css/adminlte.min.css">
    <!-- Custom Neon 3F CSS -->
    <link rel="stylesheet" href="/static/css/neon-3f.css?v=force_v2">
    <!-- Toast Notifications CSS -->
    <link rel="stylesheet" href="/static/css/toast-notifications.css">
    
    <!-- Theme Transition Style -->
    <style>
        :root.theme-transitioning,
        :root.theme-transitioning * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease !important;
        }
    </style>
    
    {% block extra_css %}
    <link rel="stylesheet" href="/static/css/transactions.css">
    {% endblock %}
</head>
<body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
        
        <!-- Navbar -->
        <nav class="app-header navbar navbar-expand bg-body">
            <div class="container-fluid">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                            <i class="fa-solid fa-bars"></i>
                        </a>
                    </li>
                    <!-- Menú Herramientas -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="toolsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa-solid fa-screwdriver-wrench me-1"></i> Herramientas
                        </a>
                        <ul class="dropdown-menu border-secondary shadow-lg">
                            <li><a class="dropdown-item" href="/entidades#entidades"><i class="fa-solid fa-building-columns small me-2 text-info"></i> Gestión de Financieras</a></li>
                            <li><a class="dropdown-item" href="/entidades#tipos"><i class="fa-solid fa-layer-group small me-2 text-warning"></i> Tipos de Financiera</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/cuentas"><i class="fa-solid fa-wallet small me-2 text-success"></i> Gestión de Cuentas</a></li>
                            <li><a class="dropdown-item" href="/beneficiarios"><i class="fa-solid fa-users small me-2 text-primary"></i> Gestión de Beneficiarios</a></li>
                            <li><a class="dropdown-item" href="/categorias"><i class="fa-solid fa-folder-tree small me-2 text-info"></i> Gestión de Categorías</a></li>
                        </ul>
                    </li>
                    <!-- Quick Access Icons -->
                    <li class="nav-item">
                        <a class="nav-link" href="/beneficiarios" title="Beneficiarios">
                            <i class="fa-solid fa-users"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/categorias" title="Categorías">
                            <i class="fa-solid fa-folder-tree"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/etiquetas" title="Etiquetas">
                            <i class="fa-solid fa-tags"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings#divisas" title="Divisas">
                            <i class="fa-solid fa-coins"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="window.print()" title="Imprimir">
                            <i class="fa-solid fa-print"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dim" href="#" title="Ayuda (próximamente)">
                            <i class="fa-solid fa-circle-question"></i>
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <!-- Language Selector -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-language me-1"></i>
                            <span x-text="$store.lang.current.toUpperCase()"></span>
                        </a>
                        <ul class="dropdown-menu border-secondary">
                            <li><a class="dropdown-item" href="#" @click="$store.lang.loadLanguage('es')">Español</a></li>
                            <li><a class="dropdown-item" href="#" @click="$store.lang.loadLanguage('en')">English</a></li>
                        </ul>
                    </li>
                    <!-- Notifications Dropdown -->
                    <li class="nav-item dropdown" id="notifications-nav-item">
                        <a class="nav-link" data-bs-toggle="dropdown" href="#" aria-expanded="false">
                            <i class="fa-solid fa-bell"></i>
                            <span class="navbar-badge badge rounded-pill bg-danger" id="notification-badge" style="display: none;">0</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end border-secondary shadow-lg" style="width: 350px;">
                            <span class="dropdown-item dropdown-header fw-bold border-bottom border-secondary border-opacity-25 py-3">
                                <span id="notification-count-text">0</span> Notificaciones
                            </span>
                            <div class="dropdown-divider m-0"></div>
                            <div id="notification-history-list" class="custom-scrollbar" style="max-height: 400px; overflow-y: auto;">
                                <!-- Individual notifications will be injected here -->
                                <div class="dropdown-item text-center text-dim py-5">
                                    <i class="fa-solid fa-bell-slash fa-2x mb-2 opacity-25"></i>
                                    <p class="mb-0">No hay notificaciones</p>
                                </div>
                            </div>
                            <div class="dropdown-divider m-0"></div>
                            <div class="d-flex border-top border-secondary border-opacity-10">
                                <a href="#" class="dropdown-item py-3 text-info fw-bold text-center border-end border-secondary border-opacity-10" id="mark-all-read-btn">
                                    <i class="fa-solid fa-check-double me-1"></i> Leer todas
                                </a>
                                <a href="#" class="dropdown-item py-3 text-danger fw-bold text-center" id="clear-notifications-btn">
                                    <i class="fa-solid fa-trash-can me-1"></i> Borrar todas
                                </a>
                            </div>
                        </div>
                    </li>

                    <!-- User Menu -->
                     <li class="nav-item dropdown user-menu">
                        <a href="#" class="nav-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown">
                            <img src="https://ui-avatars.com/api/?name=Fer&background=00f2ff&color=000" class="user-image rounded-circle shadow me-2" alt="User Image" style="width: 32px; height: 32px;">
                            <span class="d-none d-lg-inline" id="user-email">Cargando...</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end border-secondary shadow-lg">
                            <!-- Menu Header -->
                            <li class="user-header bg-black bg-opacity-25 py-4">
                                <img src="https://ui-avatars.com/api/?name=Fer&background=00f2ff&color=000" class="rounded-circle shadow mb-2" style="width: 80px;" alt="User Image">
                                <p class="mb-0 font-orbitron text-primary">Fer21gon</p>
                                <small class="text-dim">Explorador del Futuro</small>
                            </li>
                            <!-- Menu Footer -->
                            <li class="user-footer d-flex justify-content-between p-3 border-top border-secondary border-opacity-25">
                                <a href="/settings" class="btn btn-outline-info btn-sm neon-border px-3">PERFIL</a>
                                <a href="#" onclick="logout()" class="btn btn-outline-danger btn-sm neon-border px-3">SALIR</a>
                            </li>
                        </ul>
                    </li>

                </ul>
            </div>
        </nav>
        
        <!-- Sidebar -->
        <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
             <div class="sidebar-brand">
                <a href="/" class="brand-link">
                    <span class="brand-text fw-light">3F | Finanzas</span>
                </a>
            </div>
            <div class="sidebar-wrapper">
                <nav class="mt-2">
                    <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
                        <!-- Dashboard -->
                        <li class="nav-item">
                            <a href="/" class="nav-link">
                                <i class="nav-icon fa-solid fa-gauge-high"></i>
                                <p x-text="$store.lang.t('nav.dashboard')">Dashboard</p>
                            </a>
                        </li>
                        <!-- Todas las Transacciones -->
                        <li class="nav-item">
                            <a href="/transacciones" class="nav-link">
                                <i class="nav-icon fa-solid fa-money-bill-transfer"></i>
                                <p x-text="$store.lang.t('nav.transactions')">Transacciones</p>
                            </a>
                        </li>
                        <li class="nav-item menu-open" x-data="sidebarManager">
                            <a href="#" class="nav-link">
                                <i class="nav-icon fa-solid fa-wallet"></i>
                                <p>
                                    <span x-text="$store.lang.t('nav.accounts')">Cuentas</span>
                                    <i class="nav-arrow fa-solid fa-chevron-right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <!-- Favoritas -->
                                <li class="nav-item" x-show="filtered.favoritas.length > 0">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-star text-warning"></i>
                                        <p>Favoritas <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="acc in filtered.favoritas" :key="acc.id_cuenta">
                                            <li class="nav-item">
                                                <a :href="'/transacciones?id_cuenta=' + acc.id_cuenta" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-circle" :style="'color:' + (acc.color_cuenta || '#fff') + '; font-size: 0.5rem;'"></i>
                                                    <p x-text="acc.nombre_cuenta"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                                <!-- Cuentas bancarias -->
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-building-columns text-info"></i>
                                        <p>Bancarias <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="acc in filtered.bancarias" :key="'bank-'+acc.id_cuenta">
                                            <li class="nav-item">
                                                <a :href="'/transacciones?id_cuenta=' + acc.id_cuenta" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-circle-nodes small"></i>
                                                    <p x-text="acc.nombre_cuenta"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                                <!-- Tarjetas de crédito -->
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-credit-card text-danger"></i>
                                        <p>Tarjetas <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="acc in filtered.tarjetas" :key="'card-'+acc.id_cuenta">
                                            <li class="nav-item">
                                                <a :href="'/transacciones?id_cuenta=' + acc.id_cuenta" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-credit-card small"></i>
                                                    <p x-text="acc.nombre_cuenta"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                                <!-- Efectivo -->
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-money-bill-1 text-success"></i>
                                        <p>Efectivo <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="acc in filtered.efectivo" :key="'cash-'+acc.id_cuenta">
                                            <li class="nav-item">
                                                <a :href="'/transacciones?id_cuenta=' + acc.id_cuenta" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-wallet small"></i>
                                                    <p x-text="acc.nombre_cuenta"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                                <!-- Cuentas a plazo -->
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-clock text-primary"></i>
                                        <p>A Plazo <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="acc in filtered.plazo" :key="'term-'+acc.id_cuenta">
                                            <li class="nav-item">
                                                <a :href="'/transacciones?id_cuenta=' + acc.id_cuenta" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-vault small"></i>
                                                    <p x-text="acc.nombre_cuenta"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                                <!-- Cartera de acciones (Stocks) -->
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-chart-line text-accent"></i>
                                        <p>Acciones <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="stk in investments" :key="'stk-'+stk.id_inversion">
                                            <li class="nav-item">
                                                <a :href="'/inversiones?id=' + stk.id_inversion" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-arrow-trend-up small text-dim"></i>
                                                    <p x-text="stk.simbolo"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                                <!-- Activos -->
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="nav-icon fa-solid fa-box text-secondary"></i>
                                        <p>Activos <i class="nav-arrow fa-solid fa-chevron-right"></i></p>
                                    </a>
                                    <ul class="nav nav-treeview ms-3">
                                        <template x-for="ast in assets" :key="'ast-'+ast.id_activo">
                                            <li class="nav-item">
                                                <a :href="'/activos?id=' + ast.id_activo" class="nav-link">
                                                    <i class="nav-icon fa-solid fa-cube small text-dim"></i>
                                                    <p x-text="ast.nombre_activo"></p>
                                                </a>
                                            </li>
                                        </template>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="/beneficiarios" class="nav-link">
                                <i class="nav-icon fa-solid fa-users"></i>
                                <p x-text="$store.lang.t('nav.beneficiaries')">Beneficiarios</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/categorias" class="nav-link">
                                <i class="nav-icon fa-solid fa-folder-tree"></i>
                                <p x-text="$store.lang.t('nav.categories')">Categorías</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/etiquetas" class="nav-link">
                                <i class="nav-icon fa-solid fa-tags"></i>
                                <p x-text="$store.lang.t('nav.tags')">Etiquetas</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/plugins" class="nav-link">
                                <i class="nav-icon fa-solid fa-puzzle-piece"></i>
                                <p x-text="$store.lang.t('nav.plugins')">Módulos</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/metas" class="nav-link">
                                <i class="nav-icon fa-solid fa-bullseye"></i>
                                <p x-text="$store.lang.t('nav.goals') || 'Metas'">Metas</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/programadas" class="nav-link">
                                <i class="nav-icon fa-solid fa-calendar-check"></i>
                                <p x-text="$store.lang.t('nav.scheduled')">Programadas</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/activos" class="nav-link">
                                <i class="nav-icon fa-solid fa-building"></i>
                                <p x-text="$store.lang.t('nav.assets')">Activos</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/vault" class="nav-link">
                                <i class="nav-icon fa-solid fa-vault"></i>
                                <p x-text="$store.lang.t('nav.vault') || 'Bóveda Digital'">Bóveda Digital</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/audit" class="nav-link">
                                <i class="nav-icon fa-solid fa-shield-halved"></i>
                                <p x-text="$store.lang.t('nav.audit') || 'Auditoría'">Auditoría</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/inversiones" class="nav-link">
                                <i class="nav-icon fa-solid fa-arrow-trend-up"></i>
                                <p x-text="$store.lang.t('nav.stocks')">Inversiones</p>
                            </a>
                        </li>
                         <li class="nav-item">
                            <a href="/reportes" class="nav-link">
                                <i class="nav-icon fa-solid fa-chart-line"></i>
                                <p x-text="$store.lang.t('nav.reports')">Reportes</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/reportes/flujo-caja" class="nav-link">
                                <i class="nav-icon fa-solid fa-chart-bar"></i>
                                <p x-text="$store.lang.t('reports.cashflow.title')">Flujo vs Presupuesto</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/reportes/heatmap" class="nav-link">
                                <i class="nav-icon fa-solid fa-fire-flame-curved text-warning"></i>
                                <p x-text="$store.lang.t('reports.heatmap.title')">Hábitos de Gasto</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/settings" class="nav-link">
                                <i class="nav-icon fa-solid fa-gears"></i>
                                <p x-text="$store.lang.t('nav.settings') || 'Configuración'">Configuración</p>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="app-main">
            <div class="app-content-header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 class="mb-0">{% block page_title %}{% endblock %}</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="app-content">
                <div class="container-fluid">
                    {% block content %}{% endblock %}
                </div>
            </div>
        </main>

    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0-beta2/dist/js/adminlte.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
    <script src="/static/js/i18n.js?v=force_v2"></script>
    <script src="/static/js/currency-utils.js?v=force_v2"></script>
    <script src="/static/js/main.js?v=force_v2"></script>
    <script src="/static/js/sidebar-manager.js?v=force_v2"></script>
    <!-- Layout Manager (for GridStack persistence) -->
    <script src="/static/js/layout-manager.js"></script>
    <!-- Theme Manager (for dynamic theming) -->
    <script src="/static/js/theme-manager.js"></script>
    <!-- Notification Manager (for real-time notifications) -->
    <script src="/static/js/notification-manager.js"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
